<!DOCTYPE HTML>

<html>
	<head>
		<title>Leftovers | Principal</title>
		<meta charset="utf-8" />
		<link rel="icon" href="images/avatarfavicon.png" type="image/gif">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="stylesheets/main/assets/css/main.css" />
		<noscript><link rel="stylesheet" href="stylesheets/main/assets/css/noscript.css" /></noscript>
        <link rel="stylesheet" href="stylesheets/main/assets/css/modal.css" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script type="text/javascript" src="./webcam.min.js"></script>
	</head>
	<body class="is-loading">

		<!-- Wrapper -->
			<div id="wrapper" class="fade-in">

				<!-- Intro -->

				<!-- Header -->
					<header id="header">
						<p  class="logo">Leftovers</p>
					</header>

				<!-- Nav -->
					<nav id="nav">
						<ul class="links">
							<li class="active"><a href="index.html">Recetas</a></li>
							<li><a href="generic.html">Filtros</a></li>
						</ul>
						<ul class="icons">
							<li><a href="#" class="icon fa-camera" onclick="blockModal()"><span class="label">Camera</span></a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">
							<div id="myModal" class="modal">
								  <!-- Modal content -->
                                <div class="row">
                                    <div class="col-md-3"></div>
                                    <div class="modal-content col-md-6">
                                        <div class="modal-header">
                                          <h3 class="modal-title">Captura el ingrediente!</h3>
                                            <span class="close" aria-hidden="true">&times;</span>
                                        </div>
                                        <div class="modal-body row">
                                            <div class="col-md-2"></div>
                                            <div id="my_camera" class="col-md-8"></div>
                                            <div class="col-md-2"></div>
                                        </div>
                                        <div class="modal-footer">
                                            <div id="photo">
                                                <input type=button value="Hacer foto" onClick="take_snapshot()">
                                            </div>

                                            <div id="answer" style=display:none>
                                            <center><div id="contenedor" style=display:none>
												<div class="loader" id="loader">Loading...</div>
											</div></center>
                                                <label id="ingrSearch"></label>
                                                <input type=button value="Hacer otra foto" onClick="changeButtons()">
                                                <button id="add" value="Añadir" onClick="window.location.href='/principal'">Añadir</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3"></div>
                                </div>
							</div>
						<!-- Featured Post -->
							<article class="post featured">
								<header class="major">
									<span ><label id="recIng"></label></span><br>
									<hr>
									<h2><a id="title0" value="" href="#">Nombre_Receta_principal</a></h2>
								</header>
								<a href="#" class="image main"><img id="image0" src="images/main/default.jpg" alt="" /></a>
								<ul class="actions">
									<li><a id="rec0" value="" href="#" class="button big" onclick="linkarReceta(0);return false;">Ver más</a></li>
								</ul>
							</article>

						<!-- Posts -->
							<section class="posts">
								<article>
									<header>
										<h2><a id="title1" value="" href="#">Sed magna<br />
										ipsum faucibus</a></h2>
									</header>
									<a href="#" class="image fit"><img id="image1" src="images/main/default.jpg" alt="" /></a>
									<ul class="actions">
										<li><a id="rec1" value="" href="#" class="button" onclick="linkarReceta(1);return false;">Ver más</a></li>
									</ul>
								</article>
								<article>
									<header>
										<h2><a id="title2" href="#">Primis eget<br />
										imperdiet lorem</a></h2>
									</header>
									<a href="#" class="image fit"><img id="image2" src="images/main/default.jpg" alt="" /></a>
									<ul class="actions">
										<li><a id="rec2" value="" href="#" class="button" onclick="linkarReceta(2);return false;">Ver más</a></li>
									</ul>
								</article>
								<article>
									<header>
										<h2><a id="title3" href="#">Ante mattis<br />
										interdum dolor</a></h2>
									</header>
									<a href="#" class="image fit"><img id="image3" src="images/main/default.jpg" alt="" /></a>
									<ul class="actions">
										<li><a id="rec3" value="" href="#" class="button" onclick="linkarReceta(3);return false;">Ver más</a></li>
									</ul>
								</article>
								<article>
									<header>
										<h2><a id="title4" href="#">Tempus sed<br />
										nulla imperdiet</a></h2>
									</header>
									<a href="#" class="image fit"><img id="image4" src="images/main/default.jpg" alt="" /></a>
									<ul class="actions">
										<li><a id="rec4" value="" href="#" class="button" onclick="linkarReceta(4);return false;">Ver más</a></li>
									</ul>
								</article>
								<article>
									<header>
										<h2><a id="title5" href="#">Odio magna<br />
										sed consectetur</a></h2>
									</header>
									<a href="#" class="image fit"><img id="image5" src="images/main/default.jpg" alt="" /></a>
									<ul class="actions">
										<li><a id="rec5" value="" href="#" class="button" onclick="linkarReceta(5);return false;">Ver más</a></li>
									</ul>
								</article>
								<article>
									<header>
										<h2><a id="title6" href="#">Augue lorem<br />
										primis vestibulum</a></h2>
									</header>
									<a value="" href="#" class="image fit"><img id="image6" src="images/main/default.jpg" alt="" /></a>
									<ul class="actions">
										<li><a id="rec6" value="" href="#" class="button" onclick="linkarReceta(6);return false;">Ver más</a></li>
									</ul>
								</article>
							</section>

						<!-- Footer -->
							<!--<footer>
								<div class="pagination">
									<!--<a href="#" class="previous">Prev</a>
									<a href="#" class="page active">1</a>
									<a href="#" class="page">2</a>
									<a href="#" class="page">3</a>
									<span class="extra">&hellip;</span>
									<a href="#" class="page">8</a>
									<a href="#" class="page">9</a>
									<a href="#" class="page">10</a>
									<a href="#" class="next">Next</a>
								</div>
							</footer>-->

					</div>

			</div>

		<!-- Scripts -->
			<script src="stylesheets/main/assets/js/jquery.min.js"></script>
			<script src="stylesheets/main/assets/js/jquery.scrollex.min.js"></script>
			<script src="stylesheets/main/assets/js/jquery.scrolly.min.js"></script>
			<script src="stylesheets/main/assets/js/skel.min.js"></script>
			<script src="stylesheets/main/assets/js/util.js"></script>
			<script src="stylesheets/main/assets/js/main.js"></script>

	<script>
	var url_string = $(location).attr('href');
	var url = new URL(url_string);
	var modo = url.searchParams.get("modo");
	var ingrediente = url.searchParams.get("ing");
	document.getElementById("recIng").innerHTML= "Recetas con: " + ingrediente;
	//console.log(ingrediente);
	if(ingrediente != null){
		$.get( "/recipes", {ing:ingrediente}, function(data){
		// Recetas en data.recetasSoloEsosIngredientes /// data.recetasAlgunoMas
			//alert(data.recetasSoloEsosIngredientes);
			//alert(data.recetasAlgunoMas);
			for(var i=0;i < data.recetasSoloEsosIngredientes.length;i++){
				document.getElementById("rec"+i).value = data.recetasSoloEsosIngredientes[i];
				document.getElementById("title"+i).innerHTML = data.recetasSoloEsosIngredientes[i].titulo;
				document.getElementById("image"+i).src= data.recetasSoloEsosIngredientes[i].multimedia;
			}
			var j = data.recetasSoloEsosIngredientes.length;
			for(var i=0;i < 7;i++){
				document.getElementById("rec"+j).value = data.recetasAlgunoMas[i];
				document.getElementById("title"+j).innerHTML = data.recetasAlgunoMas[i].titulo;
				document.getElementById("image"+j).src= data.recetasAlgunoMas[i].multimedia;
				j++;
			}
		});
	}
	if ('addEventListener' in window) {
		window.addEventListener('load', function() { document.body.className = document.body.className.replace(/\bis-loading\b/, ''); });
		document.body.className += (navigator.userAgent.match(/(MSIE|rv:11\.0)/) ? ' is-ie' : '');
	}

		// Get the modal
	var modal = document.getElementById('myModal');

	// Get the <span> element that closes the modal
	var span = document.getElementsByClassName("close")[0];
	document.getElementById("add").disabled = true;
	// When the user clicks on the button, open the modal 
	function blockModal() {
		modal.style.display = "block";
		Webcam.set({
				width: 440,
				height: 300,
				image_format: 'jpeg',
				jpeg_quality: 90
		});
		Webcam.attach( '#my_camera' );
	}
	
	function changeButtons(){
		document.getElementById('answer').style.display = "none";
		document.getElementById('photo').style.display = "block";
		document.getElementById('ingrSearch').innerHTML = "";
		document.getElementById("add").disabled = true;
		Webcam.unfreeze();
	}

	// When the user clicks on <span> (x), close the modal
	span.onclick = function() {
		modal.style.display = "none";
	}

	// When the user clicks anywhere outside of the modal, close it
	window.onclick = function(event) {
		if (event.target == modal) {
			modal.style.display = "none";
		}
	}
	
	function take_snapshot() {
	
	var ingrVision;
	var ingrBD;
				// take snapshot and get image data
				Webcam.snap( function(data_uri) {
					// display results in page
					/*document.getElementById('results').innerHTML = 
						'<h2>Here is your image:</h2>' + 
						'<img src="'+data_uri+'"/>';*/
				Webcam.set({
				width: 440,
				height: 300,
				image_format: 'jpeg',
				jpeg_quality: 90
				});
					Webcam.freeze();
					document.getElementById('contenedor').style.display = "block";
					document.getElementById('answer').style.display = "block";
					document.getElementById('photo').style.display = "none";
					//data = data_uri;
					
					$.get( "/ingr", {}, function(data){
						//alert(JSON.stringify(data));
						ingrBD = data;
						//alert(obj);
					});
					
					$.get( "/image", {imagen:data_uri}, function(data){
						//alert(JSON.stringify(data));
						ingrVision = data;
						//alert(obj);
						var i = 0;
						var ok = false;
						var ingrediente = "";
						while (i < ingrVision.length && !ok) { 
							var j = 0;
							while(j < ingrBD.length && !ok){
								if(ingrVision[i] == ingrBD[j].nombre){
									ok = true;
									ingrediente = ingrVision[i];
								}
								j++;
							}
							i++;
						}
						document.getElementById('contenedor').style.display = "none";
						if(ingrediente != ""){ 
							document.getElementById('ingrSearch').innerHTML = 'Tu ingrediente es...' + ingrediente + '!';
							document.getElementById("add").disabled = false;
						}else{ 
							document.getElementById('ingrSearch').innerHTML = 'No lo reconocemos..haz otra foto!';
						}
					});
					//Comparación con objeto de ingredientes
	})
	}
	
	// Linkar cada receta con su página
	
	function linkarReceta(numReceta){
		//dicc.serializeArray();
		var dic = JSON.stringify(document.getElementById("rec"+numReceta).value);
		window.location = '/receta?recipe=' + dic;
	}
	</script>
	</body>
		<!--
	Based on the template of:
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
	-->
</html>